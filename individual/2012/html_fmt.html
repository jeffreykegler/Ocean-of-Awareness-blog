<html>
<head>
<link rel="alternate" title="Ocean of Awareness RSS" type="application/rss+xml" title="RSS" href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/index.rss" />
<title>Ocean of Awareness</title>
<style type="text/css">
   strong {font-weight: 700;}
</style>
</head>
<body>
<div
  style="color:white;background-color:#38B0C0;padding:1em;clear:left;text-align:center;">
<h1>Ocean of Awareness</h1>
</div>
  <div style="margin:0;padding:10px 30px 10px 10px;width:150px;float:left;border-right:2px solid #38B0C0">
  <p>
  <strong>Jeffrey Kegler's blog</strong>
  about Marpa, his new parsing algorithm,
    and other topics of interest</p>
  <p><a href="http://www.jeffreykegler.com/">Jeffrey's personal website</a></p>
      <p>
	<a href="https://twitter.com/jeffreykegler" class="twitter-follow-button" data-show-count="false">Follow @jeffreykegler</a>
      </p>
      <p style="text-align:center">
	<!-- Place this code where you want the badge to render. -->
	<a href="//plus.google.com/101567692867247957860?prsrc=3" rel="publisher" style="text-decoration:none;">
	<img src="//ssl.gstatic.com/images/icons/gplus-32.png" alt="Google+" style="border:0;width:32px;height:32px;"/></a>
      </p>
  <h3>Marpa resources</h3>
  <p><a href="http://jeffreykegler.github.com/Marpa/">The Marpa website</a></p>
  <p>The Ocean of Awareness blog: <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog">home page</a>,
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/chronological.html">chronological index</a>,
  and
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/annotated.html">annotated index</a>.
  </p>
  </div>
  <div style="margin-left:190px;border-left:2px solid #38B0C0;padding:25px;">
<h3>Thu, 13 Sep 2012</h3>
<br />
<center><a name="html_fmt"> <h2>A Marpa-based HTML reformatter</h2> </a>
</center>
    <p>
      <!--
      perl ./marpa_r2_html_fmt
      -->
      This post is about
      <tt>
        html_fmt</tt>,
      a
      <a href="http://jeffreykegler.github.com/Marpa/">
        Marpa-</a>based
      reformatter ("tidier") for liberal HTML.
      <tt>
        html_fmt</tt>
      indents HTML according to the structure of the document,
      which makes the HTML a lot easier to read.
      In the process
      <tt>
        html_fmt</tt>
      adds missing start and end tags and identifies "cruft".
    </p>
    <p>
      <tt>
        html_fmt</tt>
      is ultra-liberal about its input.
      Like a browser's rendering engine,
      <tt>
        html_fmt</tt>
      never rejects a file,
      no matter how defective it is as an HTML document.
      An interesting experiment would be to compare what your
      favorite browser does with a random text file feed to
      it directly,
      with what it does to the same file
      after it has been passed through
      <tt>
        html_fmt</tt>.
    </p>
    <p>
      <tt>
        html_fmt</tt>
      is a by-product of moving
      <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/">
        this blog to Github</a>.
      In the course of bringing over
      <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/chronological.html">
        my old posts</a>,
      I wanted a filter that would tidy them up,
      so I turned to an old demo script I'd written.
      The old demo's usefulness was a pleasant surprise,
      but it lacked two features.
      First, it wouldn't read from standard input.
      Second, in formatting the HTML, it introduced new whitespace.
      The first problem was easy to fix.
      Fixing the second involved coming up with a
      "lowest common denominator" for whitespace treatment
      among browsers and HTML variants.
    </p>
    <p>
      The result,
      <tt>
        html_fmt</tt>,
      works very well as the first step in dealing with HTML
      that you are rewriting by hand.
      One quick pass-through and your file is much easier to read,
      has all the proper tags,
      and has comments pointing out any "cruft" that's there.
    </p>
    <p>
      A production quality "tidier" would need to be something like
      <tt>
        gnuindent</tt>
      --
      bristling with options.
      <tt>
        html_fmt</tt>
      so far has only two options,
      one dealing with whitespace before end tags,
      the other allowing
      a choice of strategies for avoiding added whitespace.
      (One strategy uses comments, while the other simply leaves
      the whitespace-sensitive locations as-is.)
      These two options are not nearly
      sufficient to deal with the full
      range of whitespace issues,
      never mind anything else.
    </p>
    <p>
      But from a
      <a href="http://blog.plover.com/oops/blosxom-sux.html">
        "Worse is Better"</a>
      point of view,
      <tt>
        html_fmt</tt>
      is a good start.
      It is 600 lines,
      short enough to find your
      way around in,
      particularly once you've deleted the parts you don't like.
      And its underlying Marpa-based interface is documented:
      <a href="https://metacpan.org/module/Marpa::R2::HTML">
        Marpa::R2::HTML</a>.
      Marpa::R2::HTML is beta, but has been stable for some time.
    </p>
    <p>
      <a href="https://gist.github.com/3725639">
      <tt>
        html_fmt</tt>
      is now available as a gist.</a>
      In a future release of
      <a href="https://metacpan.org/release/Marpa-R2">
        Marpa::R2</a>,
      it will be available as the
      <tt>
        marpa_r2_html_fmt</tt> script.
      But why wait until then to fork it?
    </p>
<br />
<p>posted at: 20:08 |
<a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/individual/2012/html_fmt.html">direct link to this entry</a>
</p>
<div style="color:#38B0C0;padding:1px;text-align:center;">
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;
</div>
</div>
</div>
<div id="footer" style="border-top:thick solid #38B0C0;clear:left;padding:1em;">
<p>This is Ocean of Awareness's
  new home.  This blog has been hosted at
  <a href="http://blogs.perl.org/users/jeffrey_kegler/">blogs.perl.org</a>
  but I have succumbed to the lure of static blogging.
  I have not yet decided how to deal with comments at this new blog location.
If the post is Marpa-related,
<a href="https://groups.google.com/forum/?hl=en&fromgroups#%21forum/marpa-parser">
the Marpa mailing list</a>
is a good place to comment.
Also,
I will continue to dual-post for some time,
and have not yet frozen comments on the versions of the
post at
<a href="http://blogs.perl.org/users/jeffrey_kegler/">blogs.perl.org</a>.
</div>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33430331-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>
</body></html>
