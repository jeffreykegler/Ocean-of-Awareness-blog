<html>
<head>
<link rel="alternate" title="Ocean of Awareness RSS" type="application/rss+xml" title="RSS" href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/index.rss" />
<title>Ocean of Awareness</title>
<style type="text/css">
   strong {font-weight: 700;}
</style>
</head>
<body>
<div
  style="color:white;background-color:#38B0C0;padding:1em;clear:left;text-align:center;">
<h1>Ocean of Awareness</h1>
</div>
  <div style="margin:0;padding:10px 30px 10px 10px;width:150px;float:left;border-right:2px solid #38B0C0">
  <p>
  <strong>Jeffrey Kegler's blog</strong>
  about Marpa, his new parsing algorithm,
    and other topics of interest</p>
  <p><a href="http://www.jeffreykegler.com/">Jeffrey's personal website</a></p>
      <p>
	<a href="https://twitter.com/jeffreykegler" class="twitter-follow-button" data-show-count="false">Follow @jeffreykegler</a>
      </p>
      <p style="text-align:center">
	<!-- Place this code where you want the badge to render. -->
	<a href="//plus.google.com/101567692867247957860?prsrc=3" rel="publisher" style="text-decoration:none;">
	<img src="//ssl.gstatic.com/images/icons/gplus-32.png" alt="Google+" style="border:0;width:32px;height:32px;"/></a>
      </p>
  <h3>Marpa resources</h3>
  <p><a href="http://jeffreykegler.github.com/Marpa/">The Marpa website</a></p>
  <p>The Ocean of Awareness blog: <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog">home page</a>,
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/chronological.html">chronological index</a>,
  and
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/annotated.html">annotated index</a>.
  </p>
  </div>
  <div style="margin-left:190px;border-left:2px solid #38B0C0;padding:25px;">
<h3>Mon, 15 Oct 2012</h3>
<br />
<center><a name="config_html2"> <h2>A configurable HTML parser, part 2</h2> </a>
</center>
    <p>
      <!--
      marpa_r2_html_fmt --no-added-tag-comment
      -->
      My last post introduced Marpa::R2::HTML,
      a configurable HTML parser.
      By editing a configuration file,
      the user can change,
      over a very wide range,
      the variant of HTML
      that Marpa::R2::HTML parses.
      The previous post showed one of the simplest variations --
      the ability to specify the contents of new tags,
      and the context in which they can appear.
      <p>
      This post is about a more aggressive variation of
      the HTML grammar -- the ability to change the contents
      of the HTML body (the
      <tt>&lt;body&gt;</tt>
      element).
      <h3>Is changing the definition of the HTML body useful?</h3>
      Marpa::R2::HTML allows changing the contents of all pre-existing
      element, with the exception of the highest level one --
      the 
      <tt>&lt;html&gt;</tt> element itself.
      This can be more impressive than utilitarian,
      but in the case of the
      <tt>&lt;body&gt;</tt>
      element there is a real case to be made for allowing the
      application to choose.
      <h3>Can text appear directly in an HTML body?</h3>
      <p>Can text appear directly in an HTML
      <tt>&lt;body&gt;</tt>
      element?
      That is, must text inside an HTML
      <tt>&lt;body&gt;</tt>
      be part of one of its child elements,
      or can it be directly part of the contents
      of the 
      <tt>&lt;body&gt;</tt> element?
      <p>
      If you want an
      answer strictly according to the standards,
      then you get your choice in the matter.
      According the 
      <a href="http://www.w3.org/TR/1999/PR-html40-19990824/sgml/dtd.html#inline">
        HTML 4.01 Strict DTD</a>,
	the 
      <tt>&lt;body&gt;</tt> contains a "block flow",
      which means that
	the answer is "No, text must be in the contents of a child element".
	Implementations of HTML were encouraged to be liberal, however,
	and in practice so much of the HTML out there has text directly
	in
      <tt>&lt;body&gt;</tt> elements,
      that a browser is expected to allow it.
      <p>
	Recognizing existing practice,
	HTML 5 changed to require conforming implementations to
	allow text to be interspersed with the block flow,
	in what I call a "mixed flow".
      A mixed flow can directly contain blocks and text,
      as well as inline elements.
      (The inline vs. block element distinction is basic to HTML parsing.
      See my earlier post or
      <a href="http://en.wikipedia.org/wiki/HTML_element">
      the well-organized Wikipedia page on HTML elements</a>.)
      <h3>Block or mixed flow?</h3>
      In parsing HTML, do you want to treat the body as a block flow or a mixed flow?
      Here are some of the factors.
      <ul>
      <li>Common practice requires accepting a mixed flow.
      <li>Careful practice suggests writing a block flow.
      <li>HTML 4.01 requires block, but suggests being liberal.
      <li>HTML 5 requires that a mixed flow be accepting,
      but also requires that it be displayed as if it was blocked into
      paragraphs, and suggests that blocking be used to eliminate
      ambiguities.
      </ul>
      <h3>Examples</h3>
      Two examples parses will illustrate what I mean.
      The first uses a a block-flow
      <tt>&lt;body&gt;</tt>,
      which is the default.
      Here is the pertinent line from the configuration file:
<blockquote><pre><tt>
&lt;body&gt; is *block
</tt></pre></blockquote>
This line says
that the 
<tt>&lt;body&gt;</tt>
element contains a block flow (<tt>*block</tt>).
Here the star is a sigil which suggests the repetition operator
of DTD's and regular expressions.
(Readers of my last post will notice I've changed the configuration
file syntax and will I hope find the new format an improvement.)
<p>For all of the examples in this post,
the HTML will be
<blockquote><pre><tt>
I cannot wait for a start tag&lt;p&gt;I can
</tt></pre></blockquote>
We run this through the <tt>marpa_r2_html_fmt --no-added-tag</tt>.
(The examples here were run using Marpa::R@ release 2.021_010.
There are part of its test suite as <tt>html/t/cfg_fmt.t</tt>.)
Here is the output:
<blockquote><pre><tt>
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;
      I cannot wait for a start tag&lt;/p&gt;&lt;p>
      I can&lt;/p&gt;&lt;/body>
&lt;/html&gt;
</tt></pre></blockquote>
<p>In each example
      <p>
      Faced with all this,
      in my first implementation of the <tt>html_fmt</tt> utility,
      my grammar specified a mixed flow.
      In a second version,
      I decided that it produced a more precise parse if I was stricter in the grammar,
      and use the Ruby Slippers to "loosen things up",
      getting close, I hoped, to the best of both worlds.
      This second choice -- strict grammar and liberal Ruby Slippers --
      remains the default in the configurable version.
      <p>
      In this new configurable version,
      both the grammar and Ruby Slippers are configurable,
      and the user gets to decide.
      A user may have a clear preference,
      or may want to use different configurations
      in different situations.
<br />
<p>posted at: 18:50 |
<a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/individual/2012/config_html2.html">direct link to this entry</a>
</p>
<div style="color:#38B0C0;padding:1px;text-align:center;">
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;
</div>
</div>
</div>
<div id="footer" style="border-top:thick solid #38B0C0;clear:left;padding:1em;">
<p>This is Ocean of Awareness's
  new home.  This blog has been hosted at
  <a href="http://blogs.perl.org/users/jeffrey_kegler/">blogs.perl.org</a>
  but I have succumbed to the lure of static blogging.
  I have not yet decided how to deal with comments at this new blog location.
If the post is Marpa-related,
<a href="https://groups.google.com/forum/?hl=en&fromgroups#%21forum/marpa-parser">
the Marpa mailing list</a>
is a good place to comment.
Also,
I will continue to dual-post for some time,
and have not yet frozen comments on the versions of the
post at
<a href="http://blogs.perl.org/users/jeffrey_kegler/">blogs.perl.org</a>.
</div>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33430331-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>
</body></html>
