<html>
<head>
<link rel="alternate" title="Ocean of Awareness RSS" type="application/rss+xml" title="RSS" href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/index.rss" />
<title>Ocean of Awareness</title>
<style type="text/css">
   strong {font-weight: 700;}
</style>
</head>
<body>
<div
  style="color:white;background-color:#38B0C0;padding:1em;clear:left;text-align:center;">
<h1>Ocean of Awareness</h1>
</div>
  <div style="margin:0;padding:10px 30px 10px 10px;width:150px;float:left;border-right:2px solid #38B0C0">
  <p>
  <strong>Jeffrey Kegler's blog</strong>
  about Marpa, his new parsing algorithm,
    and other topics of interest</p>
  <p><a href="http://www.jeffreykegler.com/">Jeffrey's personal website</a></p>
      <p>
	<a href="https://twitter.com/jeffreykegler" class="twitter-follow-button" data-show-count="false">Follow @jeffreykegler</a>
      </p>
      <p style="text-align:center">
	<!-- Place this code where you want the badge to render. -->
	<a href="//plus.google.com/101567692867247957860?prsrc=3" rel="publisher" style="text-decoration:none;">
	<img src="//ssl.gstatic.com/images/icons/gplus-32.png" alt="Google+" style="border:0;width:32px;height:32px;"/></a>
      </p>
  <h3>Marpa resources</h3>
  <p><a href="http://jeffreykegler.github.com/Marpa-web-site/">The Marpa website</a></p>
  <p>The Ocean of Awareness blog: <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog">home page</a>,
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/chronological.html">chronological index</a>,
  and
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/annotated.html">annotated index</a>.
  </p>
  </div>
  <div style="margin-left:190px;border-left:2px solid #38B0C0;padding:25px;">
<h3>Sun, 09 Jun 2013</h3>
<br />
<center><a name="mixing-procedural"> <h2>Mixing procedural and declarative parsing</h2> </a>
</center>
<h2>The application</h2>
<p>In
<a href="http://blogs.perl.org/users/polettix/2012/04/parserecdescent-and-number-of-elements-read-on-the-fly.html">
a recent blog post</a>,
Flavio Poletti described an unusual language,
one which he'd written a parser for,
using the very traditional method of
recursive descent.
Specifically he'd used Perl's Parse::RecDescent
module.
Several people asked me how
<a href="http://jeffreykegler.github.com/Marpa-web-site/">
Marpa</a>
would do on this language.
This post contains
a comparison, including a benchmark.
</p>
The reader who wants an exact description should
look at
<a href="http://blogs.perl.org/users/polettix/2012/04/parserecdescent-and-number-of-elements-read-on-the-fly.html">
Flavio's post and code</a>.
I call it a Dyck-Hollerith language because it
combines
<a href="http://en.wikipedia.org/wiki/Hollerith_constant">
Hollerith constants</a>

(strings preceded by a count),
with balanced parentheses
(what is called
<a href="http://en.wikipedia.org/wiki/Dyck_language">
a Dyck language</a>
by mathematicians).
Here's Flavio's example:
<code class="prettyprint">
<pre>
A2(A2(S3(Hey)S13(Hello, World!))S5(Ciao!))
</pre>
</code>
<p>
When I did
<a href="http://blogs.perl.org/users/jeffrey_kegler/2011/11/marpa-v-perl-regexes-some-numbers.html">
a Marpa versus Perl regexes comparison</a>,
I was very careful to choose an application which showed Marpa in
a good light.
Here I did not pick the application,
and it is almost as if it was designed
to show recursive descent in a good light.
</p>
<p>

Recursive descent tries to parse by treating each rule
as a subroutine call.
This is a very natural way for a programmer
to look at a grammar.
But, alas, it only works in certain cases,
and most of those are already handled by regular expressions.
However, Dyck languages, including balanced parentheses,
are one of the boundary cases:
languages beyond the abilities of regular expressions,
but within the capabilities of recursive descent.
</p>
<p>
Hollerith constants highlight the other strength of
recursive descent.
Since recursive descent's basic idea is so intuitive, it is easy
to add custom hacks to it.
And Hollerith constants are beyond the capabilities of even
general BNF parsing.
Earley's, Marpa, CYK, GLR, you name it,
none of them can handle Hollerith constants without
some kind of custom hack.
You might say that Hollerith constants force a parser
to wrestle in the mud.
And when it comes to wrestling in the mud,
recursive descent is hard to beat.
</p>
<h2>code</h2>
<blockquote>
<pre>
#!perl
# Copyright 2013 Jeffrey Kegler
# This file is part of Marpa::R2.  Marpa::R2 is free software: you can
# redistribute it and/or modify it under the terms of the GNU Lesser
# General Public License as published by the Free Software Foundation,
# either version 3 of the License, or (at your option) any later version.
#
# Marpa::R2 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser
# General Public License along with Marpa::R2.  If not, see
# http://www.gnu.org/licenses/.

use 5.010;
use strict;
use warnings;
use Data::Dumper;
use Scalar::Util;
use Marpa::R2 2.056000;
use English qw( -no_match_vars );

# A Marpa::R2 parser for the Dyck-Hollerith language

my $repeat;
if (@ARGV) {
    $repeat = $ARGV[0];
    die 'Argument not a number'
        if not Scalar::Util::looks_like_number($repeat);
}

my $dsl = &lt;&lt;'END_OF_DSL';
# The BNF
:start ::= sentence
sentence ::= element
array ::= 'A' &lt;array count&gt; '(' elements ')'
    action =&gt; check_array
string ::= ( 'S' &lt;string length&gt; '(' ) text ( ')' )
elements ::= element+
  action =&gt; ::array
element ::= string | array

# Declare the places where we pause before
# and after lexemes
:lexeme ~ &lt;string length&gt; pause =&gt; after
:lexeme ~ text pause =&gt; before

# Declare the lexemes themselves
&lt;array count&gt; ~ [\d]+
&lt;string length&gt; ~ [\d]+
# define &lt;text&gt; as one character of anything, as a stub
# the external scanner determines its actual size and value
text ~ [\d\D]
END_OF_DSL

my $grammar = Marpa::R2::Scanless::G-&gt;new(
    {   action_object  =&gt; 'My_Actions',
        default_action =&gt; '::first',
        source         =&gt; \$dsl
    }
);

my $recce = Marpa::R2::Scanless::R-&gt;new( { grammar =&gt; $grammar } );

my $input;
if ($repeat) {
    $input = "A$repeat("
        . ( 'A2(A2(S3(Hey)S13(Hello, World!))S5(Ciao!))' x $repeat ) . ')';
}
else {
    $input = 'A2(A2(S3(Hey)S13(Hello, World!))S5(Ciao!))';
}

my $last_string_length;
my $input_length = length $input;
INPUT:
for (
    my $pos = $recce-&gt;read( \$input );
    $pos &lt; $input_length;
    $pos = $recce-&gt;resume($pos)
    )
{
    my $lexeme = $recce-&gt;pause_lexeme();
    die q{Parse exhausted in front of this string: "},
        substr( $input, $pos ), q{"}
        if not defined $lexeme;
    my ( $start, $lexeme_length ) = $recce-&gt;pause_span();
    if ( $lexeme eq 'string length' ) {
        $last_string_length = $recce-&gt;literal( $start, $lexeme_length ) + 0;
        $pos = $start + $lexeme_length;
        next INPUT;
    }
    if ( $lexeme eq 'text' ) {
        my $text_length = $last_string_length;
        $recce-&gt;lexeme_read( 'text', $start, $text_length );
        $pos = $start + $text_length;
        next INPUT;
    } ## end if ( $lexeme eq 'text' )
    die "Unexpected lexeme: $lexeme";
} ## end INPUT: for ( my $pos = $recce-&gt;read( \$input ); $pos &lt; $input_length...)

my $result = $recce-&gt;value();
die 'No parse' if not defined $result;
my $received = Data::Dumper::Dumper( ${$result} );

my $expected = &lt;&lt;'EXPECTED_OUTPUT';
$VAR1 = [
          [
            'Hey',
            'Hello, World!'
          ],
          'Ciao!'
        ];
EXPECTED_OUTPUT
if ( $received eq $expected ) {
    say 'Output matches' or die "say() failed: $ERRNO";
}
else {
    say "Output differs: $received" or die "say() failed: $ERRNO";
}

package My_Actions;

sub new { }

sub check_array {
    my ( undef, undef, $declared_size, undef, $array ) = @_;
    my $actual_size = @{$array};
    warn
        "Array size ($actual_size) does not match that specified ($declared_size)"
        if $declared_size != $actual_size;
    return $array;
} ## end sub check_array

</pre>
<blockquote>
<h2>Conclusions</h2>
<br />
<p>posted at: 14:27 |
<a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/individual/2013/06/mixing-procedural.html">direct link to this entry</a>
</p>
<div style="color:#38B0C0;padding:1px;text-align:center;">
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;
</div>
</div>
</div>
<div id="footer" style="border-top:thick solid #38B0C0;clear:left;padding:1em;">
<p>This is Ocean of Awareness's
  new home.  This blog has been hosted at
  <a href="http://blogs.perl.org/users/jeffrey_kegler/">blogs.perl.org</a>
  but I have succumbed to the lure of static blogging.
  I have not yet decided how to deal with comments at this new blog location.
If the post is Marpa-related,
<a href="https://groups.google.com/forum/?hl=en&fromgroups#%21forum/marpa-parser">
the Marpa mailing list</a>
is a good place to comment.
</div>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33430331-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>
</body></html>
