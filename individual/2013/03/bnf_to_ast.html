<html>
<head>
<link rel="alternate" title="Ocean of Awareness RSS" type="application/rss+xml" title="RSS" href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/index.rss" />
<title>Ocean of Awareness</title>
<style type="text/css">
   strong {font-weight: 700;}
</style>
</head>
<body>
<div
  style="color:white;background-color:#38B0C0;padding:1em;clear:left;text-align:center;">
<h1>Ocean of Awareness</h1>
</div>
  <div style="margin:0;padding:10px 30px 10px 10px;width:150px;float:left;border-right:2px solid #38B0C0">
  <p>
  <strong>Jeffrey Kegler's blog</strong>
  about Marpa, his new parsing algorithm,
    and other topics of interest</p>
  <p><a href="http://www.jeffreykegler.com/">Jeffrey's personal website</a></p>
      <p>
	<a href="https://twitter.com/jeffreykegler" class="twitter-follow-button" data-show-count="false">Follow @jeffreykegler</a>
      </p>
      <p style="text-align:center">
	<!-- Place this code where you want the badge to render. -->
	<a href="//plus.google.com/101567692867247957860?prsrc=3" rel="publisher" style="text-decoration:none;">
	<img src="//ssl.gstatic.com/images/icons/gplus-32.png" alt="Google+" style="border:0;width:32px;height:32px;"/></a>
      </p>
  <h3>Marpa resources</h3>
  <p><a href="http://jeffreykegler.github.com/Marpa-web-site/">The Marpa website</a></p>
  <p>The Ocean of Awareness blog: <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog">home page</a>,
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/chronological.html">chronological index</a>,
  and
  <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/metapages/annotated.html">annotated index</a>.
  </p>
  </div>
  <div style="margin-left:190px;border-left:2px solid #38B0C0;padding:25px;">
<h3>Sun, 10 Mar 2013</h3>
<br />
<center><a name="bnf_to_ast"> <h2>BNF to AST</h2> </a>
</center>
  <p>
      <!--
      marpa_r2_html_fmt --no-added-tag-comment --no-ws-ok-after-start-tag
      -->
      The latest version of Marpa takes its "whipitupitude" one step further.
      You can now go straight from your input string,
      and a BNF description of the language it is in,
      to an abstract syntax tree (AST).
    </p>
    <p>To illustrate, I'll use an example from the
      Gang of Four's (Go4) chapter on the Interpreter pattern.
      The G04 had no easy generally-applicable way to go from BNF to AST,
      a problem they dealt with by punting.
      Instead of parsing the input string,
      they just built the AST they needed it to produce in the their code.
    </p>
    <p>In this post, Marpa will take us from input string and BNF to AST.
      The Go4's example was a simple boolean expression language,
      and their primary example was
    </p>
    <blockquote>
      <pre>
true and x or y and not x
</pre>
    </blockquote>
    <p>Here, in full, is the BNF,
      together with specifications to tell Marpa how to build the AST:
    </p><blockquote>
      <pre>
:default ::= action =&gt; ::array

:start ::= &lt;boolean expression&gt;
&lt;boolean expression&gt; ::=
       &lt;variable&gt; bless =&gt; variable
     | '1' bless =&gt; constant
     | '0' bless =&gt; constant
     | ('(') &lt;boolean expression&gt; (')') action =&gt; ::first bless =&gt; ::undef
    || ('not') &lt;boolean expression&gt; bless =&gt; not
    || &lt;boolean expression&gt; ('and') &lt;boolean expression&gt; bless =&gt; and
    || &lt;boolean expression&gt; ('or') &lt;boolean expression&gt; bless =&gt; or

&lt;variable&gt; ~ [[:alpha:]] &lt;zero or more word characters&gt;
&lt;zero or more word characters&gt; ~ [\w]*

:discard ~ whitespace
whitespace ~ [\s]+
</pre>
    </blockquote>
    <p>This syntax should be fairly transparent.
    In previous posts I've given
      <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/individual/2013/01/dsl_simpler2.html">
        a tutorial</a>,
	and a
      <a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/individual/2013/01/announce_scanless.html">a
        mini-tutorial</a>.
	And of course, the interface is <a href="https://metacpan.org/module/JKEGL/Marpa-R2-2.048000/pod/Scanless/DSL.pod">
	documented</a>.
    </p>
    <p>For those skimming, here are a few quick comments on the less-obvious features.
      To guide Marpa in building the AST,
      the BNF statements have
      <tt>action</tt>
      and
      <tt>bless</tt>
      adverbs.
      The
      <tt>bless</tt>
      adverbs indicate a Perl class into which the node should be
      blessed.
      This is convenient for using an object-oriented approach with the AST.
      The
      <tt>action</tt>
      adverb tells Marpa how to build the nodes.
      "<tt>action =&gt; ::array</tt>" means the result of the rule should
      be an array containing its child nodes.
      "<tt>action =&gt; ::first</tt>" means the result of the rule should just be
      its first child.
      Many of the child symbols, especially literal strings of a structural
      nature are in parentheses.
      This indicates that the semantics should ignore them.
    </p>
    <p>A <tt>:default</tt>
      pseudo-rule specifies the defaults -- in this case the
      important one is the
      "<tt>action =&gt; ::array</tt>" adverb setting.
      The
      <tt>:start</tt>
      pseudo-rule specified the start symbol.
      And the
      <tt>:discard</tt>
      indicated that whitespace is to be discarded.
    </p>
    <p>Finally, I should mention that the Go4 did not deal with precedence,
    and so in their book the input string has parentheses.
    I've implemented the standard precedence in the grammar above.
    the double vertical bar ("<tt>||</tt>") is a "loosen" operator --
    the alternative after it is at a looser precedence than the one before.
    Alternatives separated by a single bar are at the same precedence.
    <h3>The AST</h3>
    <p>Here is the AST that results:
    </p><blockquote>
      <pre>
$VAR1 = bless( [
                 bless( [
                          bless( [
                                   'true'
                                 ], 'Boolean_Expression::variable' ),
                          bless( [
                                   'x'
                                 ], 'Boolean_Expression::variable' )
                        ], 'Boolean_Expression::and' ),
                 bless( [
                          bless( [
                                   'y'
                                 ], 'Boolean_Expression::variable' ),
                          bless( [
                                   bless( [
                                            'x'
                                          ], 'Boolean_Expression::variable' )
                                 ], 'Boolean_Expression::not' )
                        ], 'Boolean_Expression::and' )
               ], 'Boolean_Expression::or' );
</pre>
    </blockquote>
    <h3>Processing the AST</h3>
    <p>What the G04 did do was process the AST in several ways -- straight
    evaluation, copying,
    and substitution of the occurrences of a variable in one boolean expression
    by another boolean expression.
    While it is obvious that the AST above is the computational
    equivalent of the Go4's, 
    for the sake of completeness I carry out the same operations
    in the gist.
    <p>
    Marpa is self-hosting --
    it parses its own DSL using its own AST's.
    So, for example, the Marpa source file in this post,
    describing boolean expressions,
    was itself turned into an AST on its way to becoming a parser
    that turns boolean expressions into AST's.
    And <a href="https://gist.github.com/jddurand/5052023">a project to produce AST's from C code</a>
    is currently under development.
    <h3>Comments</h3>
    <p>
      Comments on this post
      can be sent to the Marpa Google Group:
      <code>marpa-parser@googlegroups.com</code>
    </p>
<br />
<p>posted at: 19:28 |
<a href="http://jeffreykegler.github.com/Ocean-of-Awareness-blog/individual/2013/03/bnf_to_ast.html">direct link to this entry</a>
</p>
<div style="color:#38B0C0;padding:1px;text-align:center;">
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&sect;
</div>
</div>
</div>
<div id="footer" style="border-top:thick solid #38B0C0;clear:left;padding:1em;">
<p>This is Ocean of Awareness's
  new home.  This blog has been hosted at
  <a href="http://blogs.perl.org/users/jeffrey_kegler/">blogs.perl.org</a>
  but I have succumbed to the lure of static blogging.
  I have not yet decided how to deal with comments at this new blog location.
If the post is Marpa-related,
<a href="https://groups.google.com/forum/?hl=en&fromgroups#%21forum/marpa-parser">
the Marpa mailing list</a>
is a good place to comment.
</div>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33430331-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>
</body></html>
